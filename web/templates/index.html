<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ .title }}</title>
    <script src="https://unpkg.com/htmx.org@1.9.10"></script>
    <script src="https://unpkg.com/htmx.org@1.9.10/dist/ext/json-enc.js"></script>
    <link rel="stylesheet" href="/static/css/style.css">
</head>
<body>
    <div class="container">
        <header>
            <h1>‚ö° URL Shortener</h1>
            <p class="subtitle">Transform your long URLs into short, shareable links</p>
        </header>

        <!-- Notification Area -->
        <div id="notification" class="notification"></div>

        <!-- Main Card -->
        <div class="card">
            <!-- Tabs -->
            <div class="tabs">
                <button class="tab-btn active" onclick="switchTab('shorten')">
                    <span class="tab-icon">üîó</span>
                    Shorten URL
                </button>
                <button class="tab-btn" onclick="switchTab('stats')">
                    <span class="tab-icon">üìä</span>
                    Get Statistics
                </button>
                <button class="tab-btn" onclick="switchTab('clean')">
                    <span class="tab-icon">üßπ</span>
                    Clean Stats
                </button>
            </div>

            <!-- Shorten URL Form -->
            <div id="shorten-tab" class="tab-content active">
                <form id="shorten-form"
                      hx-post="/"
                      hx-ext="json-enc"
                      hx-target="#result"
                      hx-swap="innerHTML"
                      hx-on::after-request="handleShortenResponse(event)">

                    <div class="form-group">
                        <label for="long_url">
                            <span class="label-icon">üåê</span>
                            Long URL
                        </label>
                        <input type="url"
                               id="long_url"
                               name="long_url"
                               placeholder="https://example.com/very/long/url/path"
                               required
                               class="input-field">
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="custom_key">
                                <span class="label-icon">‚úèÔ∏è</span>
                                Custom Key (Optional)
                            </label>
                            <input type="text"
                                   id="custom_key"
                                   name="custom_key"
                                   placeholder="my-custom-link"
                                   pattern="[a-zA-Z0-9-_]+"
                                   class="input-field">
                            <small class="help-text">Only letters, numbers, dash and underscore</small>
                        </div>

                        <div class="form-group">
                            <label for="expires_in">
                                <span class="label-icon">‚è∞</span>
                                Expires In (seconds)
                            </label>
                            <input type="number"
                                   id="expires_in"
                                   name="expires_in"
                                   placeholder="86400"
                                   value="86400"
                                   min="0"
                                   class="input-field">
                            <small class="help-text">Leave empty for no expiration (Default: 24 hours)</small>
                        </div>
                    </div>

                    <button type="submit" class="btn btn-primary">
                        <span class="btn-icon">üöÄ</span>
                        Shorten URL
                    </button>
                </form>

                <!-- Result Area -->
                <div id="result" class="result-area"></div>
            </div>

            <!-- Get Statistics Form -->
            <div id="stats-tab" class="tab-content">
                <form id="stats-form"
                      hx-target="#stats-result"
                      hx-swap="innerHTML"
                      hx-on::after-request="handleStatsResponse(event)"
                      onsubmit="return submitStatsForm(event)">

                    <div class="form-group">
                        <label for="short_key">
                            <span class="label-icon">üîë</span>
                            Short Key
                        </label>
                        <input type="text"
                               id="short_key"
                               name="short_key"
                               placeholder="abc123"
                               required
                               class="input-field">
                        <small class="help-text">Enter the short key from your shortened URL</small>
                    </div>

                    <button type="submit" class="btn btn-primary">
                        <span class="btn-icon">üìà</span>
                        Get Statistics
                    </button>
                </form>

                <!-- Stats Result Area -->
                <div id="stats-result" class="result-area"></div>
            </div>

            <!-- Clean Stats Tab -->
            <div id="clean-tab" class="tab-content">
                <div class="clean-stats-section">
                    <div class="section-header">
                        <h3>
                            <span class="label-icon">üìà</span>
                            Cleanup Statistics
                        </h3>
                        <button id="refresh-stats" class="btn btn-secondary" onclick="loadCleanupStats()">
                            <span class="btn-icon">üîÑ</span>
                            Refresh
                        </button>
                    </div>

                    <div id="cleanup-stats" class="stats-area"></div>
                </div>

                <div class="clean-actions-section">
                    <div class="section-header">
                        <h3>
                            <span class="label-icon">‚ö°</span>
                            Cleanup Actions
                        </h3>
                    </div>

                    <div class="form-group">
                        <label for="batch_size">
                            <span class="label-icon">üì¶</span>
                            Batch Size
                        </label>
                        <input type="number"
                               id="batch_size"
                               name="batch_size"
                               placeholder="1000"
                               value="1000"
                               min="1"
                               max="10000"
                               class="input-field">
                        <small class="help-text">Number of expired URLs to clean in one batch (1-10000)</small>
                    </div>

                    <button id="manual-cleanup" class="btn btn-warning" onclick="triggerManualCleanup()">
                        <span class="btn-icon">üßπ</span>
                        Run Manual Cleanup
                    </button>

                    <div id="cleanup-result" class="result-area"></div>
                </div>
            </div>
        </div>

        <!-- Recent URLs Section -->
        <div class="card recent-urls" id="recent-urls-section">
            <h3>
                <span class="label-icon">üìù</span>
                Recent URLs
                <button class="clear-btn" onclick="clearRecentURLs()" title="Clear Recent URLs">üóëÔ∏è Clear</button>
            </h3>
            <div id="recent-urls-list"></div>
        </div>

        <footer>
            <p>Built with ‚ù§Ô∏è using HTMX & Go</p>
        </footer>
    </div>

    <script src="/static/js/app.js"></script>
</body>
</html>
